<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin CMS | Zaidly</title>
  <base href="/admin/" />
  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
</head>

<body>
  <script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js"></script>

 <script>
  /* ===========================
     1. GAMBAR MODE PUBLIC (ANTI-ERROR)
  =========================== */
  CMS.registerEditorComponent({
    id: "astro_image",
    label: "Astro Image (Public)",
    fields: [
      { name: "src", label: "Pilih Gambar", widget: "image" },
      { name: "alt", label: "Alt Text (SEO)", widget: "string" }
    ],
    pattern: /^<img src="(.*?)" alt="(.*?)" \/>$/,
    fromBlock: function(match) {
      return { src: match[1], alt: match[2] };
    },
    toBlock: function(obj) {
      // Menghasilkan tag img murni (Tanpa Import!)
      return `<img src="${obj.src}" alt="${obj.alt}" />`;
    },
    toPreview: function(obj) {
      return `<img src="${obj.src}" alt="${obj.alt}" style="width:100%; height:auto; border-radius:12px;" />`;
    }
  });

  /* ===========================
     2. AFFILIATE BUTTONS (HTML MURNI)
     Supaya tidak perlu import-import lagi di MDX
  =========================== */
  CMS.registerEditorComponent({
    id: "affiliate_group",
    label: "Affiliate Buttons (Pair)",
    fields: [
      { name: "amazon_url", label: "Amazon Link", widget: "string" },
      { name: "ali_url", label: "AliExpress Link", widget: "string" }
    ],
    // Pattern disederhanakan agar mudah dibaca kembali
    pattern: /Amazon Link: (.*?) \| AliExpress Link: (.*)/,
    fromBlock: function(match) {
      return { amazon_url: match[1], ali_url: match[2] };
    },
    toBlock: function(obj) {
      // Pakai HTML murni saja Bos biar Cloudflare nggak ngamuk
      return `
<div class="flex flex-wrap gap-3 my-4">
  <a href="${obj.amazon_url || '#'}" target="_blank" rel="nofollow" class="px-4 py-2 bg-slate-800 text-white rounded-md">Buy on Amazon</a>
  <a href="${obj.ali_url || '#'}" target="_blank" rel="nofollow" class="px-4 py-2 bg-red-600 text-white rounded-md">Buy on AliExpress</a>
</div>
`;
    },
    toPreview: function(obj) {
      return `<div style="padding:10px; border:1px solid #ccc; text-align:center;">Affiliate Buttons Ready</div>`;
    }
  });
</script>
</body>
</html>