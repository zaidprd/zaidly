<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin CMS | Zaidly</title>
  <base href="/admin/">
  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
</head>
<body>
  <script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js"></script>
  <script>
    // 1. KOMPONEN GAMBAR ASTRO (SOLUSI GAMBAR TIDAK MUNCUL)
    CMS.registerEditorComponent({
      id: "astro_image",
      label: "Astro Optimized Image",
      fields: [
        { name: 'src', label: 'Select Image', widget: 'image' },
        { name: 'alt', label: 'Alt Text (SEO)', widget: 'string' }
      ],
      // Mengubah input CMS menjadi sintaks MDX Image Astro
      toBlock: function(obj) {
        return `<Image src={import("${obj.src}")} alt="${obj.alt}" />`;
      },
      // Preview di dalam editor CMS
      toPreview: function(obj) {
        return `<img src="${obj.src}" alt="${obj.alt}" style="width:100%; border-radius:8px;" />`;
      }
    });

    // 2. KOMPONEN AFFILIATE BUTTONS (SUDAH ADA DI KODE ANDA)
    CMS.registerEditorComponent({
      id: "affiliate_group",
      label: "Affiliate Buttons (Pair)",
      fields: [
        { name: 'amazon_url', label: 'Amazon Link', widget: 'string' },
        { name: 'ali_url', label: 'AliExpress Link', widget: 'string' }
      ],
      pattern: /^<div class="flex flex-wrap gap-3 my-4">[\s\S]*?href="(.*?)" merchant="Amazon"[\s\S]*?href="(.*?)" merchant="AliExpress"[\s\S]*?<\/div>$/,
      fromBlock: function(match) { return { amazon_url: match[1], ali_url: match[2] }; },
      toBlock: function(obj) {
        return `<div class="flex flex-wrap gap-3 my-4">\n  <AffiliateLink href="${obj.amazon_url}" merchant="Amazon" />\n  <AffiliateLink href="${obj.ali_url}" merchant="AliExpress" />\n</div>`;
      },
      toPreview: function(obj) { return `<div style="padding:10px; background:#f0f0f0; border-radius:5px; text-align:center;"><strong>Affiliate Pair: Amazon & AliExpress</strong></div>`; }
    });
  </script>
</body>
</html>
