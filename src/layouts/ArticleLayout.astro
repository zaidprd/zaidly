---
import BaseLayout from './BaseLayout.astro';
import TableOfContents from '../components/TableOfContents.astro'; // <--- BARU: Import Komponen TOC
import type { CollectionEntry } from 'astro:content'; 

interface Heading {
    depth: number; 
    slug: string; 
    text: string; 
}

interface CustomFrontmatter {
    title: string; 
    description: string;
    pubDate: Date; 
    author: string; 
    image?: string; 
    tags?: string[];
}

interface Props {
    frontmatter: CustomFrontmatter; 
    headings: Heading[]; 
}

const { frontmatter, headings } = Astro.props; 

// Logika Tampilan
const showSidebar = headings.filter((h: Heading) => h.depth > 1 && h.depth < 4).length > 0;

// Format Tanggal (FIX ERROR SYNTAX)
const formattedDate = frontmatter.pubDate 
    ? frontmatter.pubDate.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }) 
    : 'Date not available';

const isoDate = frontmatter.pubDate 
    ? frontmatter.pubDate.toISOString() 
    : '';
    
const headerImage = frontmatter.image || '/default-header.jpg';

// Fungsi renderTableOfContents dihapus!
---
<BaseLayout title={frontmatter.title}>
    
    <div class="flex flex-wrap max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
        
        {/* Kolom Kiri: Konten Utama */}
        <article class:list={[showSidebar ? 'lg:w-3/4 lg:pr-10' : 'w-full', 'w-full order-1']}>
            
            {/* 1. METADATA (Author | Date) */}
            <div class="text-gray-500 text-sm flex items-center justify-between flex-wrap border-b border-gray-100 pb-3 mb-4">
                
                {/* Bagian Kiri: Author & Tanggal */}
                <div class="flex items-center space-x-2">
                    <span class="text-gray-700 font-semibold">
                        Author: <span class="text-accent-primary hover:text-accent-primary-dark transition duration-150">{frontmatter.author}</span>
                    </span>
                    <span class="text-gray-400">|</span>
                    <span class="text-gray-700 font-semibold">
                        Last Updated: 
                        <time datetime={isoDate}> 
                            {formattedDate}
                        </time>
                    </span>
                </div>
            </div>

            {/* 2. JUDUL ARTIKEL (FRONTMATTER TITLE) */}
            <h1 class="text-4xl font-extrabold text-gray-900 mt-4 mb-8 max-w-3xl mx-auto leading-tight">
                {frontmatter.title}
            </h1>

            {/* 3. GAMBAR HEADER */}
            {headerImage && (
                <div class="max-w-3xl mx-auto my-8 aspect-video"> 
                    <img 
                        src={headerImage} 
                        alt={frontmatter.title} 
                        class="w-full h-full object-cover rounded-lg shadow-xl"
                    />
                </div>
            )}
            
            {/* KOREKSI: TOC di DALAM ARTIKEL (HANYA MUNCUL DI MOBILE, setelah gambar) */}
            {showSidebar && (
                <div class="lg:hidden mb-6">
                    <TableOfContents headings={headings} /> {/* <--- Panggil Komponen Baru */}
                </div>
            )}

            {/* 4. KONTEN MARKDOWN */}
            <div class="prose max-w-none">
                <slot /> 
            </div>
            
        </article>

        
        {/* Kolom Kanan: Sidebar (TOC & Iklan) - HANYA MUNCUL DI DESKTOP */}
        {showSidebar && (
            <aside class:list={['w-full order-2 mt-8 lg:mt-0 lg:sticky lg:top-20 lg:w-1/4 lg:pl-4']}>
                
                {/* 1. TABLE OF CONTENTS (TOC) - KINI DISEMBUNYIKAN DI MOBILE */}
                <div class="hidden lg:block"> 
                    <TableOfContents headings={headings} /> {/* <--- Panggil Komponen Baru */}
                </div>
                
                {/* 2. AREA IKLAN GAMBAR */}
                <div class="p-4 border border-gray-200 rounded-lg shadow-sm bg-white text-center mt-6">
                    <h3 class="font-bold text-sm text-gray-500 mb-3 uppercase">Sponsored Content</h3>
                    <a href="/" class="block hover:opacity-90 transition duration-300">
                        <img 
                            src="/images/article-3.jpg" 
                            alt="Iklan Sidebar Khusus" 
                            width="250"
                            height="300"
                            class="mx-auto rounded-md shadow-md"
                        />
                    </a>
                    <p class="text-xs text-gray-400 mt-2">Klik untuk kembali ke Home</p>
                </div>

            </aside>
        )}

    </div>
</BaseLayout>