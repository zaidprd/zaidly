---
// src/pages/index.astro

// 1. Layout & Components
import MainLayout from '../layouts/BaseLayout.astro';
import Hero from '../components/Hero.astro'; 
import WhoIsZaidly from '../components/section/WhoIsZaidly.astro'; 
import FeaturedCategories from '../components/section/FeaturedCategories.astro';
import TopPicks from '../components/section/TopPicks.astro'; 
import CoffeeGearHub from '../components/section/CoffeeGearHub.astro'; 
import LatestPosts from '../components/section/LatestArticles.astro'; 
import CoffeeBeanGuides from '../components/section/CoffeeBeanGuides.astro';

// 2. Data Fetching
import { getCollection } from 'astro:content';

const allPosts = await getCollection('blog') || []; 

// 3. Logic: Sorting & Filtering
// Menggunakan as Date untuk memastikan TypeScript senang
const sortedPosts = allPosts.sort((a, b) => 
    new Date(b.data.pubDate).getTime() - new Date(a.data.pubDate).getTime()
);

const latestPosts = sortedPosts.slice(0, 3);

// SINKRONISASI KATEGORI: Sesuaikan dengan schema di config.ts
const gearPosts = allPosts.filter(post => 
    post.data.category === 'gear-lab' || post.data.category === 'buying-guides'
).slice(0, 4);

const beanPosts = allPosts.filter(post => 
    post.data.category === 'bean-roastery'
).slice(0, 4);

// 4. Category Data
const featuredCategories = [
    { title: "Gear Guides", description: "In-depth reviews of the latest brewing tools.", url: "/gear", icon: "ri:tools-line" },
    { title: "Bean Types", description: "Discover origins, roasts, and flavor profiles.", url: "/beans", icon: "ri:seedling-line" },
    { title: "Brew Methods", description: "Master techniques from pour-over to espresso.", url: "/guides", icon: "ri:cup-line" },
    { title: "Café Culture", description: "Trends and stories from the specialty coffee world.", url: "/blog", icon: "ri:store-line" },
];
---

<MainLayout title="Best Coffee Gear Reviews & Brewing Guides | Zaidly">
    
    <Hero 
        title="Premium Coffee Gear for Home Brewing" 
        subtitle="Elevate your daily ritual with expert-reviewed espresso machines, precision grinders, and professional brewing techniques."
        linkText="Explore Gear Reviews"
        linkUrl="/gear" 
        imageAlt="Collection of premium coffee brewing tools, grinders, and espresso machines - Zaidly Coffee Gear Reviews"
    />

    <FeaturedCategories categories={featuredCategories} />

    <TopPicks />

    <WhoIsZaidly 
        title="Independent Coffee Authority" 
        subtitle="Zaidly is a dedicated coffee gear guide for home brewers. We research, test, and review equipment—from espresso machines to precision grinders—so you can invest in the right tools with total confidence."
        linkText="Our Review Process →"
        linkUrl="/about" 
    />
    
    <CoffeeGearHub posts={gearPosts} />
    <CoffeeBeanGuides posts={beanPosts} />
    
    <LatestPosts posts={latestPosts} />

</MainLayout>