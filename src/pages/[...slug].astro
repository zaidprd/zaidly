---
// ===============================================
// FILE: src/pages/[...slug].astro (FINAL COMPATIBLE)
// ===============================================

export const prerender = true; 

import { getCollection } from "astro:content"; 
import type { CollectionEntry } from 'astro:content'; 
import BaseLayout from '../layouts/BaseLayout.astro';
import ArticleLayout from '../layouts/ArticleLayout.astro'; 
import Error404 from '../components/Error404.astro'; 

type BlogPost = CollectionEntry<'blog'>;

export async function getStaticPaths() {
    const allPosts = await getCollection('blog');
    const excludedSlugs = ['admin', 'blog', 'about', 'gear', 'index', 'keystatic'];

    return allPosts
        .filter(post => !excludedSlugs.includes(post.slug)) 
        .map((post) => ({
            params: { slug: post.slug.replace('blog/', '') }, 
            props: { post },
        }));
}

const { post } = Astro.props as { post: BlogPost }; 

// 1. LOGIKA RENDER DATA
let Content: any = () => null; 
let headings: any[] = [];
let postData: any = {};

if (post) { 
    const rendered = await post.render();
    Content = rendered.Content; 
    headings = rendered.headings;
    postData = post.data;
}

// 2. DEBUG LOG (Cek terminal VS Code lu)
console.log("DEBUG - Rendering Slug:", post?.slug);
---

{post ? (
    <ArticleLayout frontmatter={postData} headings={headings}> 
        {/* Saat menggunakan component() di config, Content tidak butuh props components lagi */}
        <Content /> 
    </ArticleLayout>
) : (
    <BaseLayout title="404 Not Found">
        <Error404 /> 
    </BaseLayout>
)}