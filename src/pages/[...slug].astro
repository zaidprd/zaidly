---
import { getCollection } from "astro:content";
import BaseLayout from '../layouts/BaseLayout.astro';
import ArticleLayout from '../layouts/ArticleLayout.astro'; 
import Error404 from '../components/Error404.astro'; 

// --- Bagian 1: getStaticPaths (Menangani Routing) ---

export async function getStaticPaths() {
  // Fix 2769: Memanggil getCollection tanpa argumen lain yang memicu error
  // Kita harus meyakinkan TypeScript bahwa kita memanggil fungsi ini dengan benar
  const blog = await getCollection('blog');
  // Gunakan 'as any' pada pemanggilan untuk koleksi kedua dan ketiga
  // untuk memaksa TypeScript menerima pemanggilan yang valid ini.
  const guides = await (getCollection as any)('guides'); 
  const picks = await (getCollection as any)('picks'); 
  
  // Gabungkan semua postingan
  const allPosts = [...blog, ...guides, ...picks];

  // Map ke format params/props
  // Fix 2339: Karena kita tahu 'post' adalah ContentEntry, properti 'slug' ada.
  return allPosts.map((post: any) => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

// --- Bagian 2: Tampilan Halaman Dinamis (Tetap Sama) ---

const { post } = Astro.props;

const { Content } = await (post as any).render();

const postData = (post as any).data;
---

{post ? (
    <ArticleLayout frontmatter={postData}>
        <Content />
    </ArticleLayout>
) : (
    <BaseLayout title="404 Not Found">
        <Error404 /> 
    </BaseLayout>
)}