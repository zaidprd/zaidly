---
import { getCollection } from "astro:content";
import BaseLayout from '../layouts/BaseLayout.astro';
import ArticleLayout from '../layouts/ArticleLayout.astro'; 
import Error404 from '../components/Error404.astro'; 
import type { CollectionEntry } from 'astro:content';

// Tipe gabungan untuk semua postingan
type CombinedPost = CollectionEntry<'blog'> | CollectionEntry<'guides'> | CollectionEntry<'picks'>;

// --- Bagian 1: getStaticPaths (Menangani Routing) ---

export async function getStaticPaths() {
    // Ambil koleksi
    const blog = await getCollection('blog');
    const guides = await getCollection('guides'); 
    const picks = await getCollection('picks'); 
    
    const allPosts: CombinedPost[] = [...blog, ...guides, ...picks];

    return allPosts.map((post) => ({
        params: { slug: post.slug },
        props: { post },
    }));
}

// --- Bagian 2: Tampilan Halaman Dinamis ---

// Pastikan tipe props-nya sudah benar
const { post } = Astro.props as { post: CombinedPost }; 

// Render post dan ambil Content, dan yang terpenting: headings
const { Content, headings } = await post.render();

// Ambil postData dengan type assertion yang aman jika diperlukan, 
// tetapi seharusnya post.data sudah cukup untuk TypeScript jika layout diperbaiki.
const postData = post.data;

// Fix: Kita harus memastikan post.data memiliki tipe yang kompatibel 
// dengan CustomFrontmatter di ArticleLayout.

---

{post ? (
    <ArticleLayout frontmatter={postData as any} headings={headings}> 
        <Content />
    </ArticleLayout>
) : (
    <BaseLayout title="404 Not Found">
        <Error404 /> 
    </BaseLayout>
)}