---
import { getCollection } from "astro:content";
import BaseLayout from '../layouts/BaseLayout.astro';
import PostCard from '../components/PostCard.astro'; 
import CategoryFilter from '../components/CategoryFilter.astro'; 

// Fix 2769: Menggunakan (getCollection as any) untuk koleksi kedua dan ketiga 
// agar TypeScript menerima pemanggilan yang valid
const blogPosts = await getCollection("blog");
const guidePosts = await (getCollection as any)("guides");
const bestPicksPosts = await (getCollection as any)("picks");

// Menggabungkan semua postingan menjadi satu array
const allPosts = [...blogPosts, ...guidePosts, ...bestPicksPosts];

// Mengurutkan postingan dari yang terbaru
allPosts.sort((a, b) => (b as any).data.pubDate.getTime() - (a as any).data.pubDate.getTime());
---

<BaseLayout title="Blog, Guides & Best Picks - Zaidly">
    <div class="container max-w-4xl mx-auto py-10">
        <h1 class="text-4xl font-bold mb-4 text-coffee-dark">All Coffee Articles, Guides & Reviews</h1>
        <p class="mb-8 text-gray-600">Explore our comprehensive archive covering everything from daily brewing tips to in-depth gear reviews.</p>
        
        <CategoryFilter />

        <div class="space-y-12">
            
            {/* Tanda untuk Anchor: Brewing Guides */}
            <h2 id="guides" class="text-3xl font-bold text-coffee-dark pt-12">Brewing Guides</h2>
            <p class="text-gray-600 pb-4">In-depth tutorials and how-to articles for better brewing.</p>
            {allPosts
                // Fix 2367: Gunakan (post as any) untuk memaksa TypeScript menerima perbandingan
                .filter(post => (post as any).collection === 'guides') 
                .map((post) => (
                    <PostCard post={post} /> 
                ))}

            {/* Tanda untuk Anchor: Best Picks */}
            <h2 id="picks" class="text-3xl font-bold text-coffee-dark pt-12">Best Picks & Reviews</h2>
            <p class="text-gray-600 pb-4">Our definitive lists and reviews of the best gear to buy now.</p>
            {allPosts
                // Fix 2367: Gunakan (post as any)
                .filter(post => (post as any).collection === 'picks') 
                .map((post) => (
                    <PostCard post={post} /> 
                ))}
            
            {/* Sisa Artikel Blog (Default) */}
            <h2 class="text-3xl font-bold text-coffee-dark pt-12">General Blog Posts</h2>
            <p class="text-gray-600 pb-4">News, trends, and general coffee talk.</p>
            {allPosts
                .filter(post => (post as any).collection === 'blog') // Fix 2367
                .map((post) => (
                    <PostCard post={post} /> 
                ))}
        </div>
    </div>
</BaseLayout>